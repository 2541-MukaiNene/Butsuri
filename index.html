<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>音で色と明るさが変わる画面</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
</head>
<body>
<script>
let mic, fft;
let started = false;

function setup() {
  createCanvas(500, 300);
  colorMode(HSB, 360, 100, 100);  // H:色相, S:彩度, B:明るさ

  textSize(16);
  textAlign(LEFT, TOP);
}

// クリックしてから音まわりスタート（ブラウザの仕様対策）
function mousePressed() {
  if (!started) {
    started = true;

    userStartAudio();   // AudioContext を開始

    mic = new p5.AudioIn();
    mic.start();        // マイクON

    fft = new p5.FFT();
    fft.setInput(mic);  // FFTにマイクをつなぐ
  }
}

function draw() {
  background(0);

  if (!started) {
    fill(255);
    text("画面を一度クリックしてから話しかけてね！", 20, 20);
    return;
  }

  // ① 音の大きさ（振幅） → 明るさ
  let vol = mic.getLevel();                 // 0.0〜0.1くらい
  let bright = map(vol, 0.0, 0.1, 10, 100, true);  // 明るさに変換

  // ② 周波数スペクトルを取得
  let spectrum = fft.analyze();             // 配列（強さのリスト）
  let nyquist = sampleRate() / 2;          // ナイキスト周波数（22050Hz）

  // ③ 一番強い周波数（ピーク）を探す
  let maxIndex = 0;
  let maxVa
