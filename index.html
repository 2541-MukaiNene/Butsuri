<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>音で色と明るさが変わる画面</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/addons/p5.sound.min.js"></script>
</head>
<body>
<script>
let mic, fft;

function setup() {
  createCanvas(500, 300);
  colorMode(HSB, 360, 100, 100);  // 色を H（色相）S（彩度）B（明るさ）で指定

  mic = new p5.AudioIn();
  mic.start();        // マイクON

  fft = new p5.FFT();
  fft.setInput(mic);  // FFTにマイクをつなぐ

  textSize(16);
}

function draw() {
  background(0);

  // ① 音の大きさ（振幅）を取得
  let vol = mic.getLevel();        // 0.0〜0.3くらい
  let bright = map(vol, 0, 0.3, 10, 100, true);  // 明るさに変換

  // ② 音の高さ（周波数）を取得
  let centroid = fft.getCentroid();    // 中心周波数 [Hz]

  // 普通の声を想定して 100〜1000 Hz を赤〜紫に対応させる
  // 0度 = 赤, 280度あたり = 紫
  let hue = map(centroid, 100, 1000, 0, 280, true);

  // 画面全体をその色で塗る
  fill(hue, 100, bright);
  rect(0, 0, width, height);

  // 文字情報（デバッグ用）
  fill(0, 0, 100);
  text("音量(vol): " + vol.toFixed(3), 10, 25);
  text("推定周波数(freq): " + Math.round(centroid) + " Hz", 10, 50);
  text("色相(H): " + Math.round(hue) + "°, 明るさ(B): " + Math.round(bright), 10, 75);

  text("大きな声 → 明るく", 10, height - 40);
  text("高い声 → 紫寄り / 低い声 → 赤寄り", 10, height - 20);
}
</script>
</body>
</html>
